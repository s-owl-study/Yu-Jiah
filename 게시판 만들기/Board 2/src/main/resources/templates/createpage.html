<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Board</title>
    <!-- Favicon-->
    <link rel="icon" type="image/x-icon" href="../static/assets/favicon.ico" />
    <!-- Font Awesome icons (free version)-->
    <script src="https://use.fontawesome.com/releases/v5.15.4/js/all.js" crossorigin="anonymous"></script>
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css" />
    <link href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="/css/styles.css" rel="stylesheet" />
    <script>
        /** 게시판 - 목록 페이지 이동 */
        function goBoardList(){
            location.href = "/board/boardList";
        }

        /** 게시판 - 작성  */
        function insertBoard(){
            var boardTitle = $("#boardTitle").val(); //게시글 제목
            var boardContent = $("#boardContent").val(); //게시글 내용
            var userName = $("#userName").val(); //작성자
            var boardPassword = $("#boardPassword").val(); //비밀번호

            //정보가 하나라도 입력되지 않았을 경우
            if (boardTitle == ""){
                alert("입력되지 않은 정보가 있습니다.");
                $("#boardTitle").focus();
                return;
            }

            if (boardContent == ""){
                alert("입력되지 않은 정보가 있습니다.");
                $("#boardContent").focus();
                return;
            }

            if (userName == ""){
                alert("입력되지 않은 정보가 있습니다.");
                $("#userName").focus();
                return;
            }

            if (boardPassword == ""){
                alert("입력되지 않은 정보가 있습니다.");
                $("#boardPassword").focus();
                return;
            }

            var yn = confirm("게시글을 등록하시겠습니까?");
            if(yn){

                var filesChk = $("input[name='files[0]']").val();
                if(filesChk == ""){
                    $("input[name='files[0]']").remove();
                }

                $("#boardForm").ajaxForm({

                    url        : "/board/createBoard",
                    enctype    : "multipart/form-data",
                    cache   : false,
                    async   : true,
                    type    : "POST",
                    success : function(obj) {
                        insertBoardCallback(obj);
                    },
                    error     : function(xhr, status, error) {}

                }).submit();
            }
        }

        /** 게시판 - 작성 콜백 함수 */
        function insertBoardCallback(obj){

            if(obj != null){

                var result = obj.result;

                if(result == "SUCCESS"){
                    alert("게시글 등록을 성공하였습니다.");
                    goBoardList();

                } else {
                    alert("다시 입력해주세요");
                    return;
                }
            }
        }


        function checkFile(el) {

            // files 로 해당 파일 정보 얻기.
            var file = el.files;

            // file[0].size 는 파일 용량 정보입니다.
            if (file[0].size > 1024 * 1024 * 50) {
                // 용량 초과시 경고후 해당 파일의 용량도 보여줌
                alert('50MB 이하 파일만 등록할 수 있습니다.\n\n' + '현재파일 용량 : ' + (Math.round(file[0].size / 1024 / 1024 * 100) / 100) + 'MB');
            }
            const inputFile = document.getElementById("files");
            const video = document.getElementById("video");
            inputFile.addEventListener("change", function () {
                const file = inputFile.files[0];
                const videourl = URL.createObjectURL(file);
                video.setAttribute("src", videourl);
                video.play();
            })
        }
    </script>
</head>
<body>
<nav class="navbar navbar-expand-lg bg-secondary text-uppercase fixed-top" id="mainNav">
    <div class="container">
        <a class="navbar-brand" href="#page-top">게시판 만들기</a>
        <button class="navbar-toggler text-uppercase font-weight-bold bg-primary text-white rounded" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
            Menu
            <i class="fas fa-bars"></i>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ms-auto">
                <!--                <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded" href="#portfolio"></a></li>-->
                <!--                <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded" href="#about">About</a></li>-->
<!--                <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded" href="#contact">게시글 등록</a></li>-->

            </ul>
        </div>
    </div>
</nav>
<section class="page-section portfolio" id="portfolio">
        <div class="container">
            <h2 class="page-section-heading text-center text-uppercase text-secondary mb-0">게시글 작성</h2>
            <div class="divider-custom">
                <div class="divider-custom-line"></div>
                <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
                <div class="divider-custom-line"></div>
            </div>
        </div>
<div id="wrap">
    <div id="container">
        <div class="inner">
            <form id="boardForm" name="boardForm" action="/board/createboard" enctype="multipart/form-data" method="post" onsubmit="return false;">
                작성자: <input type="text" name="userName"> &nbsp; 비밀번호: <input type="password" name="userPassword">
            </form>
                <br><br>
                제목: <input type="text" name="boardTitle">
                <br><br> 내용: <Br>
                <textarea name="boardContent" rows="30" cols="100"></textarea>
                <br><br>
                <form method enctype="multipart/form-data">
                    <div>
                        <input type="file" name="fileNo" id="files" accept="image/png, image/jpg, image/jpeg, image/gif, video/mp4, video/avi" onchange="checkFile(this)">
                    </div>
                </form>
                <form action="mainpage.html" method="get">
                <button type="button" onclick="javascript:goBoardList()">취소</button>
                </form>
                <button type="button" onclick="javascript:insertBoard();">등록</button>
        </div>
    </div>
</div>
</section>
</body>
</html>